}

// Fonction pour retirer la r√©duction
    console.log('üóëÔ∏è Retrait de la r√©duction...');
    
    // Supprimer les donn√©es de promotion
    localStorage.removeItem('anduxara_active_promo');
    localStorage.removeItem('anduxara_cart_promo');
    
    // Supprimer le badge
    const badge = document.getElementById('badge-reduction-active');
    if (badge) {
        badge.remove();
    }
    
    // Restaurer les prix originaux
    const prixElements = document.querySelectorAll('[data-original-price]');
    prixElements.forEach(element => {
        const prixOriginal = element.getAttribute('data-original-price');
        element.textContent = prixOriginal;
        element.removeAttribute('data-original-price');
    });
    
    // Mettre √† jour le panier sans r√©duction
    const panier = JSON.parse(localStorage.getItem('panier')) || [];
    panier.forEach(produit => {
        if (produit.prixOriginal) {
            produit.prix = produit.prixOriginal;
            delete produit.prixReduit;
            delete produit.reduction;
            delete produit.prixOriginal;
        }
    });
    
    localStorage.setItem('panier', JSON.stringify(panier));
    
    // Rafra√Æchir l'affichage du panier
    if (typeof afficherPanier === 'function') {
        afficherPanier();
    }
    
    // Afficher une notification
    if (typeof showNotification === 'function') {
        showNotification('üîì R√©duction retir√©e', 'success');
    } else {
        alert('üîì R√©duction retir√©e');
    }
    
    console.log('‚úÖ R√©duction retir√©e');
}

// ===== FORMATER LE PRIX =====
function formatPrix(prix) {
    return new Intl.NumberFormat('fr-FR', {
        minimumFractionDigits: 0,
        maximumFractionDigits: 0
    }).format(prix);
}

// ===== V√âRIFIER LA SYNCHRONISATION AU CHARGEMENT =====
function verifierSynchronisationPromo() {
    console.log('üîç V√©rification synchronisation promo...');
    
    // V√©rifier si on vient de reductions.html avec un code
    const urlParams = new URLSearchParams(window.location.search);
    const codePromo = urlParams.get('codePromo');
    
    if (codePromo) {
        console.log('üéØ Code promo d√©tect√© dans URL:', codePromo);
        // Nettoyer l'URL
        window.history.replaceState({}, document.title, window.location.pathname);
    }
    
    // V√©rifier et appliquer les r√©ductions existantes
    setTimeout(() => {
        appliquerReductionPanier();
    }, 1000);
}

// ===== MODIFICATIONS √Ä LA FONCTION DE CHECKOUT =====

// Surcharger la fonction processFloatingCheckout pour inclure les infos promo
const originalProcessFloatingCheckout = window.processFloatingCheckout;
window.processFloatingCheckout = function() {
    // R√©cup√©rer les infos promo avant de proc√©der
    const promoData = localStorage.getItem('anduxara_active_promo');
    if (promoData) {
        try {
            const promo = JSON.parse(promoData);
            localStorage.setItem('commande_promo_info', JSON.stringify({
                code: promo.code,
                discount: promo.discount,
                appliedAt: promo.appliedAt
            }));
            console.log('üé´ Info promo sauvegard√©e pour commande:', promo.code);
        } catch (error) {
            console.error('Erreur sauvegarde info promo:', error);
        }
    }
    
    // Appeler la fonction originale
    if (originalProcessFloatingCheckout) {
        originalProcessFloatingCheckout();
    }
};

// ===== INITIALISATION COMPL√àTE =====
function initCompletePromoSystem() {
    // 1. D√©marrer la r√©ception des codes
    receivePromoCodeFromReductions();
    
    // 2. Initialiser le syst√®me promo
    setTimeout(initPromoSystem, 1500);
    setTimeout(updateActivePromoDisplay, 1000);
    
    console.log('‚úÖ Syst√®me promo complet initialis√©');
}

// D√©marrer au chargement de la page
document.addEventListener('DOMContentLoaded', function() {
    initCompletePromoSystem();
});

// Quand l'utilisateur finalise sa commande
async function finaliserCommande() {
    // ... vos validations existantes ...
    
    // Gestion du code promo
    const promoData = localStorage.getItem('anduxara_active_promo');
    if (promoData) {
        const promo = JSON.parse(promoData);
        const user = firebase.auth().currentUser;
        
        if (user && promo.persistent) {
            await marquerCodeUtilise(user.uid, promo.code);
        }
        
        // Nettoyer le localStorage
        localStorage.removeItem('anduxara_active_promo');
        localStorage.removeItem('anduxara_cart_promo');
    }
    
    // Continuer avec le processus de paiement...
}

<!-- Dans la section scripts -->
<script src="js/secure/promo-utils.js"></script>
</script>
</body>
</html>
