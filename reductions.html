<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>R√©ductions & Cadeaux - Andu-Xara</title>
  <style>
    body { font-family: Arial, sans-serif; margin:0; padding:0; background:#f9f9f9; }
    .container { max-width: 900px; margin: auto; padding: 20px; text-align: center; }
    h1 { color: #6a11cb; margin-bottom: 10px; }
    p { color: #444; line-height: 1.6; }
    .promo-box { background: #fff; padding: 20px; border-radius: 12px; margin: 20px 0; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
    .promo-box h2 { margin-bottom: 10px; color: #333; }
    .highlight { color: #6a11cb; font-weight: bold; }
    .input-code { padding:10px; width:70%; border-radius:6px; border:1px solid #ccc; }
    .btn-apply { padding:10px 15px; background:#6a11cb; color:white; border:none; border-radius:6px; margin-left:10px; cursor:pointer; }
    .btn-apply:hover { background:#4a0f9c; }
  </style>
</head>
<body>
  <div class="container">
    <h1>R√©ductions & Cadeaux üéÅ</h1>

    <!-- Bo√Æte de saisie du code -->
    <div class="promo-box">
      <h2>Saisir le code promotionnel</h2>
      <input id="inputCode" type="text" placeholder="Entrez votre code..." class="input-code">
      <button class="btn-apply" onclick="applyCode()">Obtenir une r√©duction</button>
      <p id="message" style="margin-top:10px; font-weight:bold;"></p>
      <p class="share">üì¢ Il reste <span class="highlight" id="codesLeft">--</span> codes promotionnels !</p>
    </div>

    <div style="margin-top:20px;">
      <a href="index.html" style="color:#6a11cb;text-decoration:none;font-weight:bold;">‚Üê Retour √† l‚Äôaccueil</a>
    </div>
  </div>

  <!-- Firebase SDK -->
  <script type="module">
    // Import Firebase
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import { getFirestore, doc, getDoc, setDoc, updateDoc, collection, getDocs } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

    // Config Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyDyi0vsB3nkxxjMoNnRWeYK4IZe7hxikCU",
      authDomain: "andu-xara-2fc48.firebaseapp.com",
      projectId: "andu-xara-2fc48",
      storageBucket: "andu-xara-2fc48.firebasestorage.app",
      messagingSenderId: "873034669698",
      appId: "1:873034669698:web:87cfdcfa009a4146e29e9b"
    };

    // Initialiser Firebase et Firestore
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // Fonction pour v√©rifier un code
    async function applyCode() {
      const entered = document.getElementById("inputCode").value.trim().toUpperCase();
      const message = document.getElementById("message");

      if (!entered) {
        message.style.color = "red";
        message.innerText = "‚ùå Veuillez entrer un code.";
        return;
      }

      const docRef = doc(db, "codesPromo", entered);
      const docSnap = await getDoc(docRef);

      if (!docSnap.exists()) {
        message.style.color = "red";
        message.innerText = "‚ùå Code invalide.";
        return;
      }

      const data = docSnap.data();
      if (data.utilise === true) {
        message.style.color = "red";
        message.innerText = "üò¢ Ce code a d√©j√† √©t√© utilis√©.";
      } else {
        await updateDoc(docRef, { utilise: true });
        message.style.color = "green";
        message.innerText = "‚úÖ Code accept√© ! Vous b√©n√©ficiez de 30% de r√©duction üéâ";
        updateCounter();
      }
    }

    // Fonction pour compter les codes restants
    async function updateCounter() {
      const colRef = collection(db, "codesPromo");
      const snapshot = await getDocs(colRef);
      let restant = 0;
      snapshot.forEach(doc => {
        if (!doc.data().utilise) restant++;
      });
      document.getElementById("codesLeft").innerText = restant;
    }

    // Charger le compteur au d√©marrage
    updateCounter();
  </script>
</body>
</html>
