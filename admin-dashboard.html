<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Admin - Codes Promo</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="firebase-config.js"></script>
<script>
    // Références Firebase
    const db = firebase.firestore();
    const auth = firebase.auth();
    
    // AuthManager simplifié
    const authManager = {
        async isAdmin() {
            const user = firebase.auth().currentUser;
            if (!user) return false;
            
            try {
                console.log("Vérification admin pour:", user.email);
                const userDoc = await db.collection('users').doc(user.uid).get();
                const userData = userDoc.data();
                console.log("Données utilisateur:", userData);
                return userDoc.exists && userData.role === 'admin';
            } catch (error) {
                console.error('Erreur vérification admin:', error);
                return false;
            }
        },

        async signIn(email, password) {
            try {
                const userCredential = await firebase.auth().signInWithEmailAndPassword(email, password);
                return { success: true, user: userCredential.user };
            } catch (error) {
                return { success: false, error: error.message };
            }
        },

        async signOut() {
            try {
                await firebase.auth().signOut();
                return { success: true };
            } catch (error) {
                return { success: false, error: error.message };
            }
        }
    };

    // Dashboard Admin
    class AdminDashboard {
        constructor() {
            this.currentSection = 'overview';
            this.init();
        }

        async init() {
            await this.checkAdminAccess();
            this.initEventListeners();
        }

        async checkAdminAccess() {
            return new Promise((resolve) => {
                firebase.auth().onAuthStateChanged(async (user) => {
                    if (user) {
                        console.log("Utilisateur connecté:", user.email);
                        const isAdmin = await authManager.isAdmin();
                        console.log("Est admin?", isAdmin);
                        
                        if (isAdmin) {
                            this.showDashboard();
                            resolve(true);
                        } else {
                            this.showAccessDenied();
                            resolve(false);
                        }
                    } else {
                        this.showLogin();
                        resolve(false);
                    }
                });
            });
        }

        showLogin() {
            document.getElementById('loginScreen').style.display = 'flex';
            document.getElementById('adminDashboard').style.display = 'none';
        }

        showDashboard() {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('adminDashboard').style.display = 'flex';
            
            const user = firebase.auth().currentUser;
            document.getElementById('adminUserName').textContent = user.displayName || user.email;
            
            this.loadDashboardData();
            this.startRealtimeUpdates();
        }

        showAccessDenied() {
            document.getElementById('loginScreen').innerHTML = `
                <div class="login-box">
                    <h2 style="text-align: center; color: #f56565;">
                        <i class="fas fa-ban"></i> Accès refusé
                    </h2>
                    <p style="text-align: center; margin: 1rem 0;">
                        Vous n'avez pas les droits d'administration.
                    </p>
                    <p style="text-align: center; margin: 1rem 0; font-size: 0.9rem;">
                        Connecté en tant que: ${firebase.auth().currentUser.email}
                    </p>
                    <button class="btn btn-outline" onclick="authManager.signOut().then(() => location.reload())" style="width: 100%;">
                        <i class="fas fa-sign-out-alt"></i> Se déconnecter
                    </button>
                </div>
            `;
        }

        initEventListeners() {
            document.getElementById('adminLoginForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                const email = document.getElementById('adminEmail').value;
                const password = document.getElementById('adminPassword').value;
                
                const result = await authManager.signIn(email, password);
                if (result.success) {
                    location.reload(); // Recharger pour vérifier les droits
                } else {
                    alert('Erreur: ' + result.error);
                }
            });
        }

async loadDashboardData() {
    try {
        console.log("Chargement des données admin...");
        
        // Codes actifs
        const activeCodes = await db.collection('promoCodes')
            .where('isActive', '==', true)
            .get();
        document.getElementById('totalCodes').textContent = activeCodes.size;

        // Utilisations totales
        const totalUsage = await db.collection('promoUsage').get();
        document.getElementById('totalUsage').textContent = totalUsage.size;

        // Utilisateurs uniques
        const uniqueUsers = await db.collection('promoUsage')
            .where('status', '==', 'applied')
            .get();
        const users = new Set(uniqueUsers.docs.map(doc => doc.data().userEmail));
        document.getElementById('uniqueUsers').textContent = users.size;

        // Tentatives échouées
        const failedAttempts = await db.collection('promoUsage')
            .where('status', '!=', 'applied')
            .get();
        document.getElementById('failedAttempts').textContent = failedAttempts.size;

        // Charger l'activité récente
        await this.loadRecentActivity();

        // Charger la table des codes
        await this.loadCodesTable();

        console.log("✅ Données chargées:", {
            codes: activeCodes.size,
            usage: totalUsage.size,
            uniqueUsers: users.size,
            failed: failedAttempts.size
        });
    } catch (error) {
        console.error('Erreur chargement données:', error);
    }
}
async loadRecentActivity() {
    try {
        const recentUsage = await db.collection('promoUsage')
            .orderBy('timestamp', 'desc')
            .limit(10)
            .get();

        const tbody = document.getElementById('recentActivity');
        tbody.innerHTML = '';

        recentUsage.forEach(doc => {
            const data = doc.data();
            const row = document.createElement('tr');
            
            const statusClass = data.status === 'applied' ? 'status-active' : 'status-inactive';
            const discountText = data.discountValue ? 
                `${data.discountValue}${data.discountType === 'percentage' ? '%' : '€'}` : 
                'N/A';

            row.innerHTML = `
                <td><strong>${data.promoCode}</strong></td>
                <td>${data.userEmail || 'Anonymous'}</td>
                <td>${new Date(data.timestamp?.toDate()).toLocaleDateString('fr-FR')}</td>
                <td><span class="status-badge ${statusClass}">${data.status}</span></td>
                <td>${discountText}</td>
            `;

            tbody.appendChild(row);
        });
    } catch (error) {
        console.error('Erreur chargement activité récente:', error);
    }
}

async loadCodesTable() {
    try {
        const codes = await db.collection('promoCodes')
            .orderBy('createdAt', 'desc')
            .get();

        const tbody = document.getElementById('codesTable');
        tbody.innerHTML = '';

        codes.forEach(doc => {
            const data = doc.data();
            const row = document.createElement('tr');
            
            const isExpired = new Date() > data.validUntil.toDate();
            const statusClass = !data.isActive ? 'status-inactive' : 
                               isExpired ? 'status-expired' : 'status-active';
            const statusText = !data.isActive ? 'Inactif' : 
                              isExpired ? 'Expiré' : 'Actif';

            const usagePercent = data.maxUses > 0 ? (data.usedCount / data.maxUses * 100).toFixed(1) : 0;

            row.innerHTML = `
                <td><strong>${data.code}</strong></td>
                <td>${data.type === 'percentage' ? 'Pourcentage' : 'Montant fixe'}</td>
                <td>${data.value}${data.type === 'percentage' ? '%' : '€'}</td>
                <td>
                    <div>${data.usedCount} / ${data.maxUses}</div>
                    <div style="background: #e2e8f0; height: 4px; border-radius: 2px; margin-top: 4px;">
                        <div style="background: #667eea; height: 100%; width: ${usagePercent}%; border-radius: 2px;"></div>
                    </div>
                </td>
                <td><span class="status-badge ${statusClass}">${statusText}</span></td>
                <td>${new Date(data.validUntil.toDate()).toLocaleDateString('fr-FR')}</td>
                <td>
                    <button class="btn btn-outline" onclick="editCode('${doc.id}')" style="padding: 4px 8px;">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="btn btn-outline" onclick="toggleCodeStatus('${doc.id}', ${!data.isActive})" style="padding: 4px 8px;">
                        <i class="fas fa-power-off"></i>
                    </button>
                </td>
            `;

            tbody.appendChild(row);
        });
    } catch (error) {
        console.error('Erreur chargement codes:', error);
    }
}

        startRealtimeUpdates() {
            // Votre code existant pour les mises à jour temps réel
        }
    }

function showSection(sectionName) {
    // Masquer toutes les sections
    document.querySelectorAll('.dashboard-section').forEach(section => {
        section.style.display = 'none';
    });
    
    // Désactiver tous les items de menu
    document.querySelectorAll('.nav-item').forEach(item => {
        item.classList.remove('active');
    });
    
    // Afficher la section sélectionnée
    const sectionElement = document.getElementById(sectionName + 'Section');
    if (sectionElement) {
        sectionElement.style.display = 'block';
    }
    
    // Activer l'item de menu correspondant
    if (event && event.target) {
        event.target.closest('.nav-item').classList.add('active');
    }
    
    // Mettre à jour le titre
    const titles = {
        overview: 'Vue d\'ensemble',
        codes: 'Gestion des codes promo',
        usage: 'Historique des utilisations',
        analytics: 'Analytics et rapports',
        settings: 'Paramètres'
    };
    document.getElementById('sectionTitle').textContent = titles[sectionName] || sectionName;
}
async function exportToCSV(type) {
    try {
        let data = [];
        let filename = '';
        let headers = [];

        switch (type) {
            case 'usage':
                const usageData = await db.collection('promoUsage')
                    .orderBy('timestamp', 'desc')
                    .get();
                
                data = usageData.docs.map(doc => {
                    const d = doc.data();
                    return {
                        'Code': d.promoCode,
                        'Utilisateur': d.userEmail || 'Anonymous',
                        'IP': d.userIP,
                        'Date': d.timestamp?.toDate().toLocaleString('fr-FR'),
                        'Statut': d.status,
                        'Raison': d.reason || '',
                        'Réduction': d.discountValue ? `${d.discountValue}${d.discountType === 'percentage' ? '%' : '€'}` : 'N/A'
                    };
                });
                
                filename = `export-utilisations-${new Date().toISOString().split('T')[0]}.csv`;
                headers = ['Code', 'Utilisateur', 'IP', 'Date', 'Statut', 'Raison', 'Réduction'];
                break;

            case 'codes':
                const codesData = await db.collection('promoCodes').get();
                
                data = codesData.docs.map(doc => {
                    const d = doc.data();
                    return {
                        'Code': d.code,
                        'Type': d.type === 'percentage' ? 'Pourcentage' : 'Montant fixe',
                        'Valeur': d.value,
                        'Utilisations': `${d.usedCount}/${d.maxUses}`,
                        'Statut': d.isActive ? 'Actif' : 'Inactif',
                        'Valide depuis': d.validFrom?.toDate().toLocaleDateString('fr-FR'),
                        'Valide jusqu\'à': d.validUntil?.toDate().toLocaleDateString('fr-FR'),
                        'Date création': d.createdAt?.toDate().toLocaleDateString('fr-FR')
                    };
                });
                
                filename = `export-codes-${new Date().toISOString().split('T')[0]}.csv`;
                headers = ['Code', 'Type', 'Valeur', 'Utilisations', 'Statut', 'Valide depuis', 'Valide jusqu\'à', 'Date création'];
                break;

            case 'recent':
                const recentData = await db.collection('promoUsage')
                    .orderBy('timestamp', 'desc')
                    .limit(100)
                    .get();
                
                data = recentData.docs.map(doc => {
                    const d = doc.data();
                    return {
                        'Code': d.promoCode,
                        'Utilisateur': d.userEmail || 'Anonymous',
                        'Date': d.timestamp?.toDate().toLocaleString('fr-FR'),
                        'Statut': d.status,
                        'Réduction': d.discountValue ? `${d.discountValue}${d.discountType === 'percentage' ? '%' : '€'}` : 'N/A'
                    };
                });
                
                filename = `export-activite-recente-${new Date().toISOString().split('T')[0]}.csv`;
                headers = ['Code', 'Utilisateur', 'Date', 'Statut', 'Réduction'];
                break;
        }

        // Convertir en CSV
        const csvContent = convertToCSV(data, headers);
        
        // Télécharger le fichier
        downloadCSV(csvContent, filename);
        
        showMessage(`Export ${type} réussi ! Fichier: ${filename}`, 'success');
        
    } catch (error) {
        console.error('Erreur export CSV:', error);
        showMessage('Erreur lors de l\'export', 'error');
    }
}

function convertToCSV(data, headers) {
    const csvRows = [];
    
    // En-têtes
    csvRows.push(headers.join(';'));
    
    // Données
    data.forEach(row => {
        const values = headers.map(header => {
            const value = row[header] || '';
            // Échapper les caractères spéciaux CSV
            return `"${String(value).replace(/"/g, '""')}"`;
        });
        csvRows.push(values.join(';'));
    });
    
    return csvRows.join('\n');
}

function downloadCSV(csvContent, filename) {
    const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
    const link = document.createElement('a');
    const url = URL.createObjectURL(blob);
    
    link.setAttribute('href', url);
    link.setAttribute('download', filename);
    link.style.visibility = 'hidden';
    
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
}

function showAnalytics() {
    // Ouvrir le dashboard admin qui a déjà la section Analytics
    showSection('analytics');
    
    // Charger les données analytics
    loadAnalyticsData();
}

async function loadAnalyticsData() {
    try {
        // Utilisations aujourd'hui
        const today = new Date();
        today.setHours(0, 0, 0, 0);
        const todayUsage = await db.collection('promoUsage')
            .where('timestamp', '>=', today)
            .get();
        document.getElementById('dailyUsage').textContent = todayUsage.size;

        // Code le plus populaire
        const allUsage = await db.collection('promoUsage')
            .where('status', '==', 'applied')
            .get();
        
        const codeCounts = {};
        allUsage.docs.forEach(doc => {
            const code = doc.data().promoCode;
            codeCounts[code] = (codeCounts[code] || 0) + 1;
        });
        
        const topCode = Object.entries(codeCounts).sort((a, b) => b[1] - a[1])[0];
        document.getElementById('topCode').textContent = topCode ? `${topCode[0]} (${topCode[1]})` : '-';

        // Taux de conversion
        const totalAttempts = await db.collection('promoUsage').get();
        const successfulAttempts = await db.collection('promoUsage')
            .where('status', '==', 'applied')
            .get();
        
        const conversionRate = totalAttempts.size > 0 
            ? Math.round((successfulAttempts.size / totalAttempts.size) * 100) 
            : 0;
        document.getElementById('conversionRate').textContent = `${conversionRate}%`;

    } catch (error) {
        console.error('Erreur chargement analytics:', error);
    }
}

function showCodeManager() {
    // Ouvrir la section codes du dashboard
    showSection('codes');
    
    // Afficher un modal de création de code
    showCreateCodeModal();
}

function showCreateCodeModal() {
    const modalHTML = `
        <div id="createCodeModal" class="modal" style="display: flex;">
            <div class="modal-content" style="max-width: 500px;">
                <span class="close" onclick="closeModal('createCodeModal')">&times;</span>
                <h2><i class="fas fa-plus-circle"></i> Créer un code promo</h2>
                
                <form id="createCodeForm">
                    <div class="form-group">
                        <label>Code</label>
                        <input type="text" id="newCode" required pattern="[A-Z0-9]{3,20}" 
                               placeholder="EXEMPLE20 (lettres majuscules et chiffres)">
                    </div>
                    
                    <div class="form-group">
                        <label>Type de réduction</label>
                        <select id="discountType" required>
                            <option value="percentage">Pourcentage (%)</option>
                            <option value="fixed">Montant fixe (€)</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>Valeur</label>
                        <input type="number" id="discountValue" required min="1" 
                               placeholder="10 pour 10% ou 10€">
                    </div>
                    
                    <div class="form-group">
                        <label>Nombre d'utilisations maximum</label>
                        <input type="number" id="maxUses" required min="1" value="100">
                    </div>
                    
                    <div class="form-group">
                        <label>Valide jusqu'au</label>
                        <input type="date" id="validUntil" required 
                               value="${new Date(new Date().setFullYear(new Date().getFullYear() + 1)).toISOString().split('T')[0]}">
                    </div>
                    
                    <div class="form-actions">
                        <button type="submit" class="form-btn primary">
                            <i class="fas fa-save"></i> Créer le code
                        </button>
                        <button type="button" class="form-btn secondary" onclick="closeModal('createCodeModal')">
                            Annuler
                        </button>
                    </div>
                </form>
            </div>
        </div>
    `;
    
    // Ajouter le modal au body
    document.body.insertAdjacentHTML('beforeend', modalHTML);
    
    // Gérer la soumission du formulaire
    document.getElementById('createCodeForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        await createNewCode();
    });
}

async function createNewCode() {
    try {
        const codeData = {
            code: document.getElementById('newCode').value.toUpperCase(),
            type: document.getElementById('discountType').value,
            value: parseInt(document.getElementById('discountValue').value),
            maxUses: parseInt(document.getElementById('maxUses').value),
            usedCount: 0,
            validFrom: new Date(),
            validUntil: new Date(document.getElementById('validUntil').value),
            isActive: true,
            createdAt: new Date()
        };

        // Vérifier si le code existe déjà
        const existingCode = await db.collection('promoCodes')
            .where('code', '==', codeData.code)
            .get();

        if (!existingCode.empty) {
            alert('Ce code existe déjà !');
            return;
        }

        // Créer le code
        await db.collection('promoCodes').add(codeData);
        
        showMessage('Code créé avec succès !', 'success');
        closeModal('createCodeModal');
        
        // Recharger la table des codes
        if (adminDashboard.loadCodesTable) {
            adminDashboard.loadCodesTable();
        }
        
    } catch (error) {
        console.error('Erreur création code:', error);
        showMessage('Erreur lors de la création du code', 'error');
    }
}

function closeModal(modalId) {
    const modal = document.getElementById(modalId);
    if (modal) {
        modal.remove();
    }
}

function showMessage(text, type) {
    // Créer ou réutiliser un élément de message
    let messageDiv = document.getElementById('dashboardMessage');
    if (!messageDiv) {
        messageDiv = document.createElement('div');
        messageDiv.id = 'dashboardMessage';
        messageDiv.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 12px 20px;
            border-radius: 8px;
            color: white;
            font-weight: 600;
            z-index: 10000;
            transition: all 0.3s;
        `;
        document.body.appendChild(messageDiv);
    }
    
    messageDiv.textContent = text;
    messageDiv.style.background = type === 'success' ? '#48bb78' : '#f56565';
    messageDiv.style.display = 'block';
    
    setTimeout(() => {
        messageDiv.style.display = 'none';
    }, 5000);
}

    function showCreateCodeModal() {
        alert('Création de code - À implémenter');
    }

    function editCode(codeId) {
        alert(`Édition code ${codeId} - À implémenter`);
    }

    function toggleCodeStatus(codeId, newStatus) {
        if (confirm('Voulez-vous vraiment modifier le statut de ce code ?')) {
            db.collection('promoCodes').doc(codeId).update({
                isActive: newStatus
            });
        }
    }

    // Initialisation
    document.addEventListener('DOMContentLoaded', () => {
        adminDashboard = new AdminDashboard();
    });
</script>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f6fa;
            color: #2d3748;
        }

        .admin-container {
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            width: 250px;
            background: #2d3748;
            color: white;
            padding: 1.5rem 0;
        }

        .sidebar-header {
            padding: 0 1.5rem 1.5rem;
            border-bottom: 1px solid #4a5568;
            margin-bottom: 1rem;
        }

        .sidebar-header h1 {
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .nav-menu {
            list-style: none;
        }

        .nav-item {
            padding: 0.8rem 1.5rem;
            cursor: pointer;
            transition: background 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .nav-item:hover, .nav-item.active {
            background: #4a5568;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            padding: 2rem;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }

        .header h2 {
            color: #2d3748;
        }

        .user-menu {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: white;
            padding: 1.5rem;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            border-left: 4px solid #667eea;
        }

        .stat-card.success {
            border-left-color: #48bb78;
        }

        .stat-card.warning {
            border-left-color: #ed8936;
        }

        .stat-card.danger {
            border-left-color: #f56565;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            margin: 0.5rem 0;
        }

        .stat-label {
            color: #718096;
            font-size: 0.9rem;
        }

        /* Tables */
        .table-container {
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .table-header {
            padding: 1.5rem;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .table-actions {
            display: flex;
            gap: 0.5rem;
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: all 0.3s;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-success {
            background: #48bb78;
            color: white;
        }

        .btn-danger {
            background: #f56565;
            color: white;
        }

        .btn-outline {
            background: transparent;
            border: 1px solid #e2e8f0;
            color: #4a5568;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid #e2e8f0;
        }

        th {
            background: #f7fafc;
            font-weight: 600;
            color: #4a5568;
        }

        .status-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .status-active {
            background: #c6f6d5;
            color: #276749;
        }

        .status-inactive {
            background: #fed7d7;
            color: #c53030;
        }

        .status-expired {
            background: #feebcb;
            color: #c05621;
        }

        /* Login Screen */
        .login-screen {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .login-box {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            width: 90%;
            max-width: 400px;
        }

        .loading {
            text-align: center;
            padding: 2rem;
            color: #667eea;
        }
select {
    width: 100%;
    padding: 12px;
    border: 2px solid #e2e8f0;
    border-radius: 8px;
    font-size: 16px;
    background: white;
}

select:focus {
    outline: none;
    border-color: #667eea;
}

input[type="date"] {
    width: 100%;
    padding: 12px;
    border: 2px solid #e2e8f0;
    border-radius: 8px;
    font-size: 16px;
}

input[type="date"]:focus {
    outline: none;
    border-color: #667eea;
}

    </style>
</head>
<body>
    <!-- Écran de connexion -->
    <div id="loginScreen" class="login-screen">
        <div class="login-box">
            <h2 style="text-align: center; margin-bottom: 1.5rem;">
                <i class="fas fa-lock"></i> Accès Admin
            </h2>
            <form id="adminLoginForm">
                <div style="margin-bottom: 1rem;">
                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Email</label>
                    <input type="email" id="adminEmail" style="width: 100%; padding: 10px; border: 2px solid #e2e8f0; border-radius: 6px;" required>
                </div>
                <div style="margin-bottom: 1.5rem;">
                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Mot de passe</label>
                    <input type="password" id="adminPassword" style="width: 100%; padding: 10px; border: 2px solid #e2e8f0; border-radius: 6px;" required>
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%;">
                    <i class="fas fa-sign-in-alt"></i> Se connecter
                </button>
            </form>
        </div>
    </div>

    <!-- Dashboard Admin -->
    <div id="adminDashboard" class="admin-container" style="display: none;">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="sidebar-header">
                <h1><i class="fas fa-crown"></i> Admin Panel</h1>
            </div>
            <ul class="nav-menu">
                <li class="nav-item active" onclick="showSection('overview')">
                    <i class="fas fa-tachometer-alt"></i> Vue d'ensemble
                </li>
                <li class="nav-item" onclick="showSection('codes')">
                    <i class="fas fa-tags"></i> Codes Promo
                </li>
                <li class="nav-item" onclick="showSection('usage')">
                    <i class="fas fa-history"></i> Utilisations
                </li>
                <li class="nav-item" onclick="showSection('analytics')">
                    <i class="fas fa-chart-bar"></i> Analytics
                </li>
                <li class="nav-item" onclick="showSection('settings')">
                    <i class="fas fa-cog"></i> Paramètres
                </li>
            </ul>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <div class="header">
                <h2 id="sectionTitle">Vue d'ensemble</h2>
                <div class="user-menu">
                    <span id="adminUserName">Admin</span>
                    <button class="btn btn-outline" onclick="authManager.signOut()">
                        <i class="fas fa-sign-out-alt"></i> Déconnexion
                    </button>
                </div>
            </div>

            <!-- Section Vue d'ensemble -->
            <div id="overviewSection" class="dashboard-section">
                <div class="stats-grid">
                    <div class="stat-card">
                        <i class="fas fa-tag"></i>
                        <div class="stat-value" id="totalCodes">0</div>
                        <div class="stat-label">Codes actifs</div>
                    </div>
                    <div class="stat-card success">
                        <i class="fas fa-check-circle"></i>
                        <div class="stat-value" id="totalUsage">0</div>
                        <div class="stat-label">Utilisations totales</div>
                    </div>
                    <div class="stat-card warning">
                        <i class="fas fa-users"></i>
                        <div class="stat-value" id="uniqueUsers">0</div>
                        <div class="stat-label">Utilisateurs uniques</div>
                    </div>
                    <div class="stat-card danger">
                        <i class="fas fa-times-circle"></i>
                        <div class="stat-value" id="failedAttempts">0</div>
                        <div class="stat-label">Tentatives échouées</div>
                    </div>
                </div>

                <div class="table-container">
                    <div class="table-header">
                        <h3>Activité récente</h3>
                        <button class="btn btn-outline" onclick="exportToCSV('recent')">
                            <i class="fas fa-download"></i> Exporter
                        </button>
                    </div>
                    <div style="padding: 1rem;">
                        <table>
                            <thead>
                                <tr>
                                    <th>Code</th>
                                    <th>Utilisateur</th>
                                    <th>Date</th>
                                    <th>Statut</th>
                                    <th>Réduction</th>
                                </tr>
                            </thead>
                            <tbody id="recentActivity">
                                <!-- Rempli dynamiquement -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Section Codes Promo -->
            <div id="codesSection" class="dashboard-section" style="display: none;">
                <div class="table-container">
                    <div class="table-header">
                        <h3>Gestion des codes promo</h3>
                        <div class="table-actions">
                            <button class="btn btn-primary" onclick="showCreateCodeModal()">
                                <i class="fas fa-plus"></i> Nouveau code
                            </button>
                            <button class="btn btn-outline" onclick="exportToCSV('codes')">
                                <i class="fas fa-download"></i> Exporter
                            </button>
                        </div>
                    </div>
                    <div style="padding: 1rem;">
                        <table>
                            <thead>
                                <tr>
                                    <th>Code</th>
                                    <th>Type</th>
                                    <th>Valeur</th>
                                    <th>Utilisations</th>
                                    <th>Statut</th>
                                    <th>Expiration</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="codesTable">
                                <!-- Rempli dynamiquement -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
<!-- Section Utilisations -->
<div id="usageSection" class="dashboard-section" style="display: none;">
    <div class="table-container">
        <div class="table-header">
            <h3>Historique des utilisations</h3>
            <button class="btn btn-outline" onclick="exportToCSV('usage')">
                <i class="fas fa-download"></i> Exporter
            </button>
        </div>
        <div style="padding: 1rem;">
            <table>
                <thead>
                    <tr>
                        <th>Code</th>
                        <th>Utilisateur</th>
                        <th>Date</th>
                        <th>IP</th>
                        <th>Statut</th>
                        <th>Réduction</th>
                    </tr>
                </thead>
                <tbody id="usageTable">
                    <!-- Rempli dynamiquement -->
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Section Analytics -->
<div id="analyticsSection" class="dashboard-section" style="display: none;">
    <div class="stats-grid">
        <div class="stat-card">
            <i class="fas fa-chart-line"></i>
            <div class="stat-value" id="dailyUsage">0</div>
            <div class="stat-label">Utilisations aujourd'hui</div>
        </div>
        <div class="stat-card success">
            <i class="fas fa-trophy"></i>
            <div class="stat-value" id="topCode">-</div>
            <div class="stat-label">Code le plus populaire</div>
        </div>
        <div class="stat-card warning">
            <i class="fas fa-clock"></i>
            <div class="stat-value" id="conversionRate">0%</div>
            <div class="stat-label">Taux de conversion</div>
        </div>
    </div>
</div>

<!-- Section Paramètres -->
<div id="settingsSection" class="dashboard-section" style="display: none;">
    <div class="table-container">
        <div class="table-header">
            <h3>Paramètres système</h3>
        </div>
        <div style="padding: 1.5rem;">
            <p>Paramètres de configuration du système de codes promo.</p>
            <!-- Ajouter plus de paramètres ici -->
        </div>
    </div>
</div>

            <!-- Autres sections (usage, analytics, settings) seront ajoutées -->
        </div>
    </div>

</body>
</html>
